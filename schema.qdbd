# Modify the code to update the DB schema diagram.
# To reset the sample schema, replace everything with
# two dots ('..' - without quotes).

# Master list mapping instance UIDs to the tables that contain
# modality-specific attributes, and also contains attributes that are
# common across modalities
CompositeContext
-
InstitutionName
StationName
EquipmentUID
ProductId
SOPClassUID
SOPInstanceUID PK
StudyInstanceUID
SeriesInstanceUID
StudyDate
SeriesDate
StudyTime
SeriesTime
Modality
StudyDescription
SeriesDescription
PatientName
PatientID
PatientSex
PatientAge
PatientWeight
BodyPartExamined
ManufacturerModelName
SoftwareVersions

# Patient clinical data
CD
-
SOPInstanceUID FK -> CompositeContext.SOPInstanceUID
ProblemList_Problem_CodeValue
ProblemList_Problem_CodingSchemeDesignator
ProblemList_Problem_CodeMeaning
ProblemList_Therapy_CodeValue
ProblemList_Therapy_CodingSchemeDesignator
ProblemList_Therapy_CodeMeaning
SocialHistory_TobaccoSmokingBehavior_CodeValue
SocialHistory_TobaccoSmokingBehavior_CodingSchemeDesignator
SocialHistory_TobaccoSmokingBehavior_CodeMeaning
SocialHistory_AlcoholConsumption_CodeValue
SocialHistory_AlcoholConsumption_CodingSchemeDesignator
SocialHistory_AlcoholConsumption_CodeMeaning
SocialHistory_DetailsOfTobaccoChewing_CodeValue
SocialHistory_DetailsOfTobaccoChewing_CodingSchemeDesignator
SocialHistory_DetailsOfTobaccoChewing_CodeMeaning
TumorStaging_PrimaryTumorSite_CodeValue
TumorStaging_PrimaryTumorSite_CodingSchemeDesignator
TumorStaging_PrimaryTumorSite_CodeMeaning
TumorStaging_TumorStageFinding_CodeValue
TumorStaging_TumorStageFinding_CodingSchemeDesignator
TumorStaging_TumorStageFinding_CodeMeaning
TumorStaging_TStage_CodeValue
TumorStaging_TStage_CodingSchemeDesignator
TumorStaging_TStage_CodeMeaning
TumorStaging_NStage_CodeValue
TumorStaging_NStage_CodingSchemeDesignator
TumorStaging_NStage_CodeMeaning
TumorStaging_MStage_CodeValue
TumorStaging_MStage_CodingSchemeDesignator
TumorStaging_MStage_CodeMeaning
MedicalHistory_RadiationTherapy_CodeValue
MedicalHistory_RadiationTherapy_CodingSchemeDesignator
MedicalHistory_RadiationTherapy_CodeMeaning
MedicalHistory_MalignantNeoplasm_CodeValue
MedicalHistory_MalignantNeoplasm_CodingSchemeDesignator
MedicalHistory_MalignantNeoplasm_CodeMeaning
Biopsy_DateOfProcedure
Biopsy_Site
Surgery_DateOfProcedure
Surgery_ProcedureDescription
Surgery_ResectionOfPrimaryTumor_CodeValue
Surgery_ResectionOfPrimaryTumor_CodingSchemeDesignator
Surgery_ResectionOfPrimaryTumor_CodeMeaning
Surgery_BlockDissectionOfCervicalLymphNodes_CodeValue
Surgery_BlockDissectionOfCervicalLymphNodes_CodingSchemeDesignator
Surgery_BlockDissectionOfCervicalLymphNodes_CodeMeaning
Radiotherapy_DateTreatmentStarted
Radiotherapy_DateTreatmentStopped
Radiotherapy_TotalRadiationDoseDelivered
Radiotherapy_RadiationDosePerFraction
Radiotherapy_ProcedureDescription
Chemotherapy_DateTreatmentStarted
Chemotherapy_DateTreatmentStopped
Chemotherapy_AntineoplasticAgent_CodeValue
Chemotherapy_AntineoplasticAgent_CodingSchemeDesignator
Chemotherapy_AntineoplasticAgent_CodeMeaning
OriginalPathology_Pathology_CodeValue
OriginalPathology_Pathology_CodingSchemeDesignator
OriginalPathology_Pathology_CodeMeaning
OriginalPathology_HistologicalGradeFinding_CodeValue
OriginalPathology_HistologicalGradeFinding_CodingSchemeDesignator
OriginalPathology_HistologicalGradeFinding_CodeMeaning
OriginalPathology_MalignancyType_CodeValue
OriginalPathology_MalignancyType_CodingSchemeDesignator
OriginalPathology_MalignancyType_CodeMeaning
OriginalPathology_TumorMarginStatus_CodeValue
OriginalPathology_TumorMarginStatus_CodingSchemeDesignator
OriginalPathology_TumorMarginStatus_CodeMeaning
OriginalPathology_PerineuralInvasionFinding_CodeValue
OriginalPathology_PerineuralInvasionFinding_CodingSchemeDesignator
OriginalPathology_PerineuralInvasionFinding_CodeMeaning
OriginalPathology_StatusOfVascularInvasionByTumor_CodeValue
OriginalPathology_StatusOfVascularInvasionByTumor_CodingSchemeDesignator
OriginalPathology_StatusOfVascularInvasionByTumor_CodeMeaning
CervicalLymphNodeGroupExcision_CervicalLymphNodeGroup_CodeValue
CervicalLymphNodeGroupExcision_CervicalLymphNodeGroup_CodingSchemeDesignator
CervicalLymphNodeGroupExcision_CervicalLymphNodeGroup_CodeMeaning
CervicalLymphNodeGroupExcision_Sidedness_CodeValue
CervicalLymphNodeGroupExcision_Sidedness_CodingSchemeDesignator
CervicalLymphNodeGroupExcision_Sidedness_CodeMeaning
CervicalLymphNodeGroupExcision_NumberOfNodesRemoved
CervicalLymphNodeGroupExcision_NumberOfNodesPositive
CervicalLymphNodeGroupExcision_StatusOfExtraCapsularExtensionOfNodalTumor_CodeValue
CervicalLymphNodeGroupExcision_StatusOfExtraCapsularExtensionOfNodalTumor_CodingSchemeDesignator
CervicalLymphNodeGroupExcision_StatusOfExtraCapsularExtensionOfNodalTumor_CodeMeaning
CervicalLymphNodeGroupExcision_Comment
DiseaseOutcome_FollowupVisitDate
DiseaseOutcome_FollowupStatus_CodeValue
DiseaseOutcome_FollowupStatus_CodingSchemeDesignator
DiseaseOutcome_FollowupStatus_CodeMeaning
DiseaseOutcome_DateOfDeath
DiseaseOutcome_CauseOfDeath_CodeValue
DiseaseOutcome_CauseOfDeath_CodingSchemeDesignator
DiseaseOutcome_CauseOfDeath_CodeMeaning
DiseaseOutcome_PostRadiotherapyTreatment_CodeValue
DiseaseOutcome_PostRadiotherapyTreatment_CodingSchemeDesignator
DiseaseOutcome_PostRadiotherapyTreatment_CodeMeaning
DiseaseOutcome_DateOfCancerRecurrence
DiseaseOutcome_LocationOfFirstRecurrence_CodeValue
DiseaseOutcome_LocationOfFirstRecurrence_CodingSchemeDesignator
DiseaseOutcome_LocationOfFirstRecurrence_CodeMeaning
DiseaseOutcome_Pathology_CodeValue
DiseaseOutcome_Pathology_CodingSchemeDesignator
DiseaseOutcome_Pathology_CodeMeaning
DiseaseOutcome_HistologicalGradeFinding_CodeValue
DiseaseOutcome_HistologicalGradeFinding_CodingSchemeDesignator
DiseaseOutcome_HistologicalGradeFinding_CodeMeaning
DiseaseOutcome_MalignancyType_CodeValue
DiseaseOutcome_MalignancyType_CodingSchemeDesignator
DiseaseOutcome_MalignancyType_CodeMeaning
DiseaseOutcome_TumorMarginStatus_CodeValue
DiseaseOutcome_TumorMarginStatus_CodingSchemeDesignator
DiseaseOutcome_TumorMarginStatus_CodeMeaning
DiseaseOutcome_PerineuralInvasionFinding_CodeValue
DiseaseOutcome_PerineuralInvasionFinding_CodingSchemeDesignator
DiseaseOutcome_PerineuralInvasionFinding_CodeMeaning
DiseaseOutcome_StatusOfVascularInvasionByTumor_CodeValue
DiseaseOutcome_StatusOfVascularInvasionByTumor_CodingSchemeDesignator
DiseaseOutcome_StatusOfVascularInvasionByTumor_CodeMeaning

# PT-specific attrubutes (all top-level)
PT
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
SliceThickness
ImagePositionPatient
ImageOrientationPatient
FrameOfReferenceUID
Rows
Columns
PixelSpacing
ReconstructionMethod
ConvolutionKernel

# CT-specific attributes (all top-level)
CT
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
SliceThickness
ImagePositionPatient
ImageOrientationPatient
FrameOfReferenceUID
Rows
Columns
PixelSpacing
ReconstructionDiameter
DistanceSourceToDetector
DistanceSourceToPatient
RotationDirection
ExposureTime
XRayTubeCurrent
Exposure
FilterType
GeneratorPower
FocalSpots
ConvolutionKernel

# MR-specific attributes (all top-level)
MR
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
SliceThickness
PixelSpacing
ScanningSequence
SequenceVariant
RepetitionTime
EchoTime
InversionTime
EchoNumbers
ImagingFrequency
MagneticFieldStrength
TriggerTime
AcquisitionMatrix
InPlanePhaseEncodingDirection
FlipAngle
NumberOfEchoes
PulseSequenceName
PixelBandwidth

# Flattened (selectively)
#  ReferencedImageRealWorldValueMappingSequence
RWV
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
#
Units_CodeValue
Units_CodingSchemeDesignator
Units_CodeMeaning
Quantity_CodeValue
Quantity_CodingSchemeDesignator
Quantity_CodeMeaning
MeasurementMethod_CodeValue
MeasurementMethod_CodingSchemeDesignator
MeasurementMethod_CodeMeaning
RealWorldValueIntercept
RealWorldValueSlope

# SEG-specific attributes (all top-level)
SEG
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
NumberOfFrames
Rows
Columns
SegmentationType
ContentCreatorName
ClinicalTrialTimePointID
ClinicalTrialSeriesID

# SR-specific attributes
SR
-
SOPInstanceUID FK - CompositeContext.SOPInstanceUID
TemplateIdentifier
CompletionFlag
VerificationFlag

# Flattened selected content of SegmentSequence
#  Use modality prefix to establish relationships as to what modalities
#  these tables apply to
SEG_Segments
-
SOPInstanceUID FK >- SEG.SOPInstanceUID
SegmentNumber
SegmentAlgorithmType
SegmentAlgorithmName
SegmentLabel
AnatomicRegionSequence_CodeValue
AnatomicRegionSequence_CodingSchemeDesignator
AnatomicRegionSequence_CodeMeaning
SegmentedPropertyCategoryCodeSequence_CodeValue
SegmentedPropertyCategoryCodeSequence_CodingSchemeDesignator
SegmentedPropertyCategoryCodeSequence_CodeMeaning
SegmentedPropertyTypeCodeSequence_CodeValue
SegmentedPropertyTypeCodeSequence_CodingSchemeDesignator
SegmentedPropertyTypeCodeSequence_CodeMeaning

# Flattened selected content of SharedFunctionalGroupsSequence
#  and PerFrameFunctionalGroupsSequence
SEG_SegmentFrames
-
SOPInstanceUID FK >- SEG_Segments.SOPInstanceUID
ReferencedSegmentNumber FK >- SEG_Segments.SegmentNumber
SliceThickness
SpacingBetweenSlices
PixelSpacing
ImagePositionPatient
ImageOrientationPatient
ReferencedSOPInstanceUID
ReferencedSOPClassUID

# Flattened (selectively) from the Measurements groups container
#  of TID 1500 documents
SR1500_MeasurementGroups
-
SOPInstanceUID FK >- SR.SOPInstanceUID
# the following are concepts mapped to column names, and values extracted from the
#  SR tree. This is not generic and will not work for an arbitrary SR that does not
#  conform to TID 1500
PersonObserverName # <has obs context PNAME:(,,"Person Observer Name")="User2">
DeviceObserverName # <has obs context TEXT:(,,"Device Observer Name")="Automated Aortic Arch Refer...">
ObserverType # can be either Person or Device!
activitySession
TrackingIdentifier
TrackingUniqueIdentifier PK
Finding_CodeValue
Finding_CodingSchemeDesignator
Finding_CodeMeaning
timePoint
FindingSite_CodeValue
FindingSite_CodingSchemeDesignator
FindingSite_CodeMeaning
measurementMethod_CodeValue
measurementMethod_CodingSchemeDesignator
measurementMethod_CodeMeaning

# Individual measurements from the measurement groups
SR1500_Measurements
-
SOPInstanceUID FK >- SR1500_MeasurementGroups.SOPInstanceUID
TrackingUniqueIdentifier FK >- SR1500_MeasurementGroups.TrackingUniqueIdentifier
quantity_CodeValue
quantity_CodingSchemeDesignator
quantity_CodeMeaning
units_CodeValue
units_CodingSchemeDesignator
units_CodeMeaning
value
derivationModifier_CodeValue
derivationModifier_CodingSchemeDesignator
derivationModifier_CodeMeaning
measurementMethod_CodeValue
measurementMethod_CodingSchemeDesignator
measurementMethod_CodeMeaning


# Flattened content of the
# ReferencedSeriesSequence from
#  the object types that contain it
# These are instances pointed to from the given instance
References
-
SOPInstanceUID FK -< CompositeContext.SOPInstanceUID
ReferencedSOPClassUID string # to
ReferencedSOPInstanceUID string
SeriesInstanceUID string
